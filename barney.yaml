image-manifests:
  build-floor:
    entry:
      mounts:
      - target: /dev
        source: /dev
        options: rbind
      - target: /proc
        source: proc
        type: proc
      - target: /tmp
        source: tmp
        type: tmpfs
    units:
    - floor: arista.com/horseland/alpine%floor-builder
      sh: |
        apk add --root=$DESTDIR --initdb alpine-base make git gawk gcc libcap-dev libcap-static musl-dev util-linux
        mkdir -p $DESTDIR/src $DESTDIR/dest $DESTDIR/proc
    - image: arista.com/horseland/scdoc%static
  static:
    units:
    - floor: arista.com/horseland/bestie%build-floor
      sh: make install LDFLAGS="-static"
  test-floor:
    units:
    - floor: arista.com/horseland/alpine%floor-builder
      sh: install -m 644 -D entry-settings.json $DESTDIR/etc/barney/entry.d/1-bestie
    - image: arista.com/horseland/bestie%build-floor
    - image: arista.com/horseland/bestie%static
  breadth_test:
    units:
    - floor: arista.com/horseland/bestie%test-floor
      sh: make check BINS=
